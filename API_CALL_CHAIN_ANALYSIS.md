# YouTube API è°ƒç”¨é“¾åˆ†æä¸é…é¢ä¼˜åŒ–æ–¹æ¡ˆ

## ğŸ“ å®Œæ•´è°ƒç”¨é“¾è·¯å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         UI å±‚ (Frontend)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  app/page.tsx                                                    â”‚
â”‚  â”œâ”€ useState: selectedCompetitor, selectedPlatform, debugMode   â”‚
â”‚  â”œâ”€ handleRun() å‡½æ•°                                             â”‚
â”‚  â”‚  â””â”€ fetch('/api/run-youtube', {                              â”‚
â”‚  â”‚       method: 'POST',                                         â”‚
â”‚  â”‚       body: { competitorId, debug, platform }                â”‚
â”‚  â”‚     })                                                        â”‚
â”‚  â”‚                                                               â”‚
â”‚  â””â”€ UI ç»„ä»¶:                                                     â”‚
â”‚     â”œâ”€ ç«å“å¡ç‰‡ç½‘æ ¼ (competitor-grid)                            â”‚
â”‚     â”œâ”€ å¹³å°é€‰æ‹©å™¨ (platform-buttons)                             â”‚
â”‚     â””â”€ Run Analysis æŒ‰é’®                                         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ HTTP POST
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åç«¯ API å±‚ (Backend)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  app/api/run-youtube/route.ts                                   â”‚
â”‚  â”œâ”€ POST() ä¸»å‡½æ•°                                                â”‚
â”‚  â”‚  â”œâ”€ 1. é…é¢æ£€æŸ¥: isQuotaExceeded()                           â”‚
â”‚  â”‚  â”œâ”€ 2. ç«å“é…ç½®: getCompetitor(competitorId)                 â”‚
â”‚  â”‚  â”œâ”€ 3. æŸ¥è¯¢ç”Ÿæˆ: buildOptimizedQueries(competitor)           â”‚
â”‚  â”‚  â”‚    â””â”€ ç”Ÿæˆ 2-3 ä¸ªä¼˜åŒ–æŸ¥è¯¢ (ä½¿ç”¨ OR åˆå¹¶)                  â”‚
â”‚  â”‚  â”‚                                                            â”‚
â”‚  â”‚  â”œâ”€ 4. æœç´¢è§†é¢‘å¾ªç¯:                                          â”‚
â”‚  â”‚  â”‚    for (query of queries) {                               â”‚
â”‚  â”‚  â”‚      â”œâ”€ searchVideos(query, 25, debug, useCache=true) â”€â” â”‚
â”‚  â”‚  â”‚      â”œâ”€ æ”¶é›† videoIds åˆ° uniqueVideoIds (Setå»é‡)        â”‚ â”‚
â”‚  â”‚  â”‚      â””â”€ æ”¶é›† channelIds åˆ° uniqueChannelIds (Setå»é‡)    â”‚ â”‚
â”‚  â”‚  â”‚    }                                                       â”‚ â”‚
â”‚  â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚  â”œâ”€ 5. è·å–è§†é¢‘è¯¦æƒ…:                                          â”‚ â”‚
â”‚  â”‚  â”‚    â””â”€ getVideos(videoIds[]) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚                                                        â”‚  â”‚ â”‚
â”‚  â”‚  â”œâ”€ 6. æå–è¯æ® & èšåˆ:                                       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â””â”€ extractEvidence() for each video               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                        â”‚  â”‚ â”‚
â”‚  â”‚  â”œâ”€ 7. è·å–é¢‘é“ç»Ÿè®¡:                                          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â””â”€ getChannels(channelIds[]) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                        â”‚â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€ 8. è¯„åˆ† & æ’åº:                                          â”‚â”‚  â”‚ â”‚
â”‚  â”‚       â””â”€ scoreCreator() for each channel                â”‚â”‚  â”‚ â”‚
â”‚  â”‚                                                           â”‚â”‚  â”‚ â”‚
â”‚  â””â”€ è¿”å›: { channels[], quotaInfo, debugStats }             â”‚â”‚  â”‚ â”‚
â”‚                                                              â”‚â”‚  â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”¼â”€â”€â”¼â”€â”˜
                                                               â”‚â”‚  â”‚
                                                               â”‚â”‚  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”¼â”€â”€â”¼â”€â”
â”‚                  YouTube Service å±‚                          â”‚â”‚  â”‚ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”¼â”€â”€â”¼â”€â”¤
â”‚                                                              â”‚â”‚  â”‚ â”‚
â”‚  src/lib/youtube.ts                                          â”‚â”‚  â”‚ â”‚
â”‚  â”œâ”€ Fail Fast æœºåˆ¶:                                          â”‚â”‚  â”‚ â”‚
â”‚  â”‚  â”œâ”€ quotaExceededFlag (å…¨å±€æ ‡å¿—)                          â”‚â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€ isQuotaExceeded() æ£€æŸ¥                                â”‚â”‚  â”‚ â”‚
â”‚  â”‚                                                           â”‚â”‚  â”‚ â”‚
â”‚  â”œâ”€ searchVideos() â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚ â”‚
â”‚  â”‚  â”œâ”€ 1. æ£€æŸ¥ç¼“å­˜ (cache.get)                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â”œâ”€ å‘½ä¸­: è¿”å›ç¼“å­˜æ•°æ® (0 é…é¢)                         â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â””â”€ æœªå‘½ä¸­: ç»§ç»­ API è°ƒç”¨                               â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                           â”‚  â”‚ â”‚
â”‚  â”‚  â”œâ”€ 2. è°ƒç”¨ YouTube API: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚  â”‚ â”‚
â”‚  â”‚  â”‚    â””â”€ youtubeFetch('search', params) â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚       â””â”€ GET youtube/v3/search?        â”‚             â”‚   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚          part=snippet                  â”‚             â”‚   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚          type=video                    â”‚             â”‚   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚          q={query}                     â”‚             â”‚   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚          maxResults=25                 â”‚             â”‚   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚          publishedAfter={60days}       â”‚             â”‚   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚          regionCode=US                 â”‚             â”‚   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚          relevanceLanguage=en          â”‚             â”‚   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                         â”‚             â”‚   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚       é…é¢æ¶ˆè€—: 100 units âœ…            â”‚             â”‚   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                         â”‚             â”‚   â”‚  â”‚ â”‚
â”‚  â”‚  â”œâ”€ 3. æå– videoIds å’Œ channelIds (å»é‡)  â”‚             â”‚   â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€ 4. å­˜å…¥ç¼“å­˜ (cache.set, TTL=12h)       â”‚             â”‚   â”‚  â”‚ â”‚
â”‚  â”‚                                             â”‚             â”‚   â”‚  â”‚ â”‚
â”‚  â”œâ”€ getVideos(videoIds[]) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚  â”œâ”€ 1. æ‰¹é‡å¤„ç† (æœ€å¤š 50 ä¸ª/æ¬¡)                                  â”‚ â”‚
â”‚  â”‚  â”œâ”€ 2. è°ƒç”¨ YouTube API: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚ â”‚
â”‚  â”‚  â”‚    â””â”€ youtubeFetch('videos', params) â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â”‚
â”‚  â”‚  â”‚       â””â”€ GET youtube/v3/videos?        â”‚             â”‚       â”‚ â”‚
â”‚  â”‚  â”‚          part=snippet,contentDetails   â”‚             â”‚       â”‚ â”‚
â”‚  â”‚  â”‚          id={videoId1,videoId2,...}    â”‚             â”‚       â”‚ â”‚
â”‚  â”‚  â”‚          maxResults=50                 â”‚             â”‚       â”‚ â”‚
â”‚  â”‚  â”‚                                         â”‚             â”‚       â”‚ â”‚
â”‚  â”‚  â”‚       é…é¢æ¶ˆè€—: 1 unit per batch âœ…     â”‚             â”‚       â”‚ â”‚
â”‚  â”‚  â”‚                                         â”‚             â”‚       â”‚ â”‚
â”‚  â”‚  â””â”€ 3. è§£æè¿”å›æ•°æ®                         â”‚             â”‚       â”‚ â”‚
â”‚  â”‚                                             â”‚             â”‚       â”‚ â”‚
â”‚  â””â”€ getChannels(channelIds[]) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚     â”œâ”€ 1. æ‰¹é‡å¤„ç† (æœ€å¤š 50 ä¸ª/æ¬¡)                                       â”‚
â”‚     â”œâ”€ 2. è°ƒç”¨ YouTube API: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚     â”‚    â””â”€ youtubeFetch('channels', params) â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚     â”‚       â””â”€ GET youtube/v3/channels?      â”‚             â”‚            â”‚
â”‚     â”‚          part=snippet,statistics       â”‚             â”‚            â”‚
â”‚     â”‚          id={channelId1,channelId2,..} â”‚             â”‚            â”‚
â”‚     â”‚          maxResults=50                 â”‚             â”‚            â”‚
â”‚     â”‚                                         â”‚             â”‚            â”‚
â”‚     â”‚       é…é¢æ¶ˆè€—: 1 unit per batch âœ…     â”‚             â”‚            â”‚
â”‚     â”‚                                         â”‚             â”‚            â”‚
â”‚     â””â”€ 3. è§£æè¿”å›æ•°æ®                         â”‚             â”‚            â”‚
â”‚                                               â”‚             â”‚            â”‚
â”‚  youtubeFetch() â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  â”œâ”€ Fail Fast æ£€æŸ¥ (quotaExceededFlag)                                  â”‚
â”‚  â”œâ”€ fetch(API_BASE + endpoint + params)                                 â”‚
â”‚  â”œâ”€ é”™è¯¯å¤„ç†:                                                            â”‚
â”‚  â”‚  â””â”€ æ£€æµ‹ 403 quotaExceeded â†’ è®¾ç½® quotaExceededFlag                 â”‚
â”‚  â””â”€ è¿”å›æ•°æ®                                                             â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                 â–²
                                                 â”‚
                                                 â”‚ HTTPS
                                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    YouTube Data API v3 (Google)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                            â”‚
â”‚  https://www.googleapis.com/youtube/v3/                                   â”‚
â”‚  â”œâ”€ search?part=snippet&type=video&...        [100 units/call]           â”‚
â”‚  â”œâ”€ videos?part=snippet,contentDetails&...    [1 unit/call]              â”‚
â”‚  â””â”€ channels?part=snippet,statistics&...      [1 unit/call]              â”‚
â”‚                                                                            â”‚
â”‚  é…é¢é™åˆ¶: 10,000 units/day                                                â”‚
â”‚  é‡ç½®æ—¶é—´: UTC 00:00 (åŒ—äº¬æ—¶é—´ 08:00)                                      â”‚
â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š å½“å‰é…é¢æ¶ˆè€—åˆ†æ

### å•æ¬¡åˆ†ææµç¨‹ï¼ˆæ ‡å‡†æ¨¡å¼ï¼‰

| æ­¥éª¤ | API è°ƒç”¨ | è°ƒç”¨æ¬¡æ•° | å•æ¬¡é…é¢ | æ€»é…é¢ |
|------|---------|---------|---------|--------|
| 1. æœç´¢è§†é¢‘ | `search.list` | 2-3 æ¬¡ | 100 units | **200-300 units** |
| 2. è·å–è§†é¢‘è¯¦æƒ… | `videos.list` | 2-3 æ¬¡ (æ‰¹é‡50ä¸ª) | 1 unit | **2-3 units** |
| 3. è·å–é¢‘é“ç»Ÿè®¡ | `channels.list` | 1-2 æ¬¡ (æ‰¹é‡50ä¸ª) | 1 unit | **1-2 units** |
| **æ€»è®¡** | - | **5-8 æ¬¡** | - | **~300 units** |

### ç¼“å­˜å‘½ä¸­æ—¶

| æ­¥éª¤ | API è°ƒç”¨ | é…é¢ |
|------|---------|------|
| 1. æœç´¢è§†é¢‘ | ç¼“å­˜å‘½ä¸­ | **0 units** âœ… |
| 2. è·å–è§†é¢‘è¯¦æƒ… | ç¼“å­˜å‘½ä¸­ | **0 units** âœ… |
| 3. è·å–é¢‘é“ç»Ÿè®¡ | ç¼“å­˜å‘½ä¸­ | **0 units** âœ… |
| **æ€»è®¡** | - | **0 units** âœ… |

---

## ğŸ” å·²å®ç°çš„ä¼˜åŒ–ç­–ç•¥

### âœ… 1. å‡å°‘ search.list æ¬¡æ•°ï¼ˆæ ¸å¿ƒä¼˜åŒ–ï¼‰

**æ”¹é€ å‰**ï¼š
```typescript
// 10-20 ä¸ªç‹¬ç«‹æŸ¥è¯¢
const queries = [
  'WEEX ref',
  'WEEX referral',
  'WEEX invite',
  'WEEX exchange ref',
  'WEEX exchange referral',
  // ... å…± 10-20 ä¸ª
]
// é…é¢: 10-20 Ã— 100 = 1000-2000 units
```

**æ”¹é€ å**ï¼š
```typescript
// 2-3 ä¸ªä¼˜åŒ–æŸ¥è¯¢ï¼ˆä½¿ç”¨ OR åˆå¹¶ï¼‰
const queries = [
  'WEEX (referral OR promo code OR partnership OR rebate OR sponsored)',
  'WEEX (futures OR perps OR leverage OR margin trading)',
  'WEEX (review OR tutorial OR guide)'
]
// é…é¢: 2-3 Ã— 100 = 200-300 units âœ… é™ä½ 85%
```

**å®ç°ä½ç½®**ï¼š
- `src/lib/queryBuilder.ts` - `buildOptimizedQueries()`
- `app/api/run-youtube/route.ts` - ç¬¬ 329 è¡Œ

---

### âœ… 2. å¢åŠ ç¼“å­˜ï¼ˆé¿å…é‡å¤æ¶ˆè€—ï¼‰

**ç¼“å­˜å±‚çº§**ï¼š
- **å†…å­˜ç¼“å­˜**: è¿›ç¨‹å†…å¿«é€Ÿè®¿é—®
- **æ–‡ä»¶ç¼“å­˜**: `.cache/` ç›®å½•æŒä¹…åŒ–

**ç¼“å­˜ç­–ç•¥**ï¼š
```typescript
// src/lib/youtube.ts - searchVideos()
const cacheKey = buildCacheKey('search', { query, maxResults, debug })
const cached = cache.get(cacheKey)
if (cached) {
  // ç¼“å­˜å‘½ä¸­ - 0 é…é¢æ¶ˆè€— âœ…
  return { videoIds: cached.videoIds, channelIds: cached.channelIds, stats: { cacheHit: true } }
}

// API è°ƒç”¨
const data = await youtubeFetch('search', params)  // 100 units

// å­˜å…¥ç¼“å­˜ (TTL = 12 å°æ—¶)
cache.set(cacheKey, { videoIds, channelIds }, { ttlMs: 12 * 60 * 60 * 1000 })
```

**æ•ˆæœ**ï¼š
- 12 å°æ—¶å†…é‡å¤æŸ¥è¯¢ï¼š**0 é…é¢**
- ç¼“å­˜å‘½ä¸­ç‡ç»Ÿè®¡ï¼šå‰ç«¯å¯è§

**å®ç°ä½ç½®**ï¼š
- `src/lib/cache.ts` - ç¼“å­˜ç³»ç»Ÿ
- `src/lib/youtube.ts` - ç¬¬ 248-259 è¡Œ

---

### âœ… 3. é¢‘é“å»é‡ï¼ˆé¿å…é‡å¤è¯·æ±‚ï¼‰

**ç­–ç•¥**ï¼š
```typescript
// app/api/run-youtube/route.ts
const uniqueChannelIds = new Set<string>()

for (const query of queries) {
  const result = await searchVideos(query)
  // å…ˆæ”¶é›†æ‰€æœ‰ channelIds
  result.channelIds.forEach(id => uniqueChannelIds.add(id))
}

// æ‰¹é‡æ‹‰å–ï¼ˆæœ€å¤š 50 ä¸ª/æ¬¡ï¼‰
const channels = await getChannels(Array.from(uniqueChannelIds))
```

**æ•ˆæœ**ï¼š
- âŒ æ”¹é€ å‰: æ¯ä¸ªè§†é¢‘å•ç‹¬æ‹‰å–é¢‘é“ (100 æ¬¡ API è°ƒç”¨)
- âœ… æ”¹é€ å: å»é‡åæ‰¹é‡æ‹‰å– (2-3 æ¬¡ API è°ƒç”¨) â†’ èŠ‚çœ 97%

**å®ç°ä½ç½®**ï¼š
- `app/api/run-youtube/route.ts` - ç¬¬ 340-380 è¡Œ

---

### âœ… 4. Fail Fastï¼ˆé…é¢ä¿æŠ¤ï¼‰

**æœºåˆ¶**ï¼š
```typescript
// src/lib/youtube.ts
let quotaExceededFlag = false

async function youtubeFetch() {
  // 1. æ£€æŸ¥é…é¢æ ‡å¿—
  if (quotaExceededFlag) {
    throw new Error('quota exceeded (fail fast)')  // ç«‹å³æ‹’ç»
  }
  
  // 2. API è°ƒç”¨
  const response = await fetch(url)
  
  // 3. æ£€æµ‹ 403 quotaExceeded
  if (error.reason === 'quotaExceeded') {
    quotaExceededFlag = true  // è®¾ç½®å…¨å±€æ ‡å¿—
    // åç»­æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè¢«ç«‹å³æ‹’ç»
  }
}
```

**æ•ˆæœ**ï¼š
- âœ… é‡åˆ° 403 ç«‹å³åœæ­¢æ‰€æœ‰æŸ¥è¯¢
- âœ… é¿å…é›ªä¸ŠåŠ éœœï¼ˆä¸ç»§ç»­æ¶ˆè€—é…é¢ï¼‰

**å®ç°ä½ç½®**ï¼š
- `src/lib/youtube.ts` - ç¬¬ 14-39, 157-214 è¡Œ

---

### âœ… 5. é™åˆ¶å­—æ®µï¼ˆpart å‚æ•°ä¼˜åŒ–ï¼‰

**ä¼˜åŒ–**ï¼š
```typescript
// searchVideos - åªè¯·æ±‚å¿…è¦å­—æ®µ
part: 'snippet'  // åªè¦ snippetï¼Œä¸è¦ statistics

// getVideos - åªè¯·æ±‚å¿…è¦å­—æ®µ
part: 'snippet,contentDetails'  // ä¸è¦ statistics, player

// getChannels - åªè¯·æ±‚å¿…è¦å­—æ®µ
part: 'snippet,statistics'  // ä¸è¦ contentDetails, topicDetails
```

**æ•ˆæœ**ï¼š
- âœ… å‡å°‘ç½‘ç»œä¼ è¾“
- âœ… åŠ å¿«å“åº”é€Ÿåº¦
- âŒ é…é¢æ¶ˆè€—ä¸å˜ï¼ˆé…é¢åªçœ‹ API è°ƒç”¨æ¬¡æ•°ï¼Œä¸çœ‹å­—æ®µå¤šå°‘ï¼‰

**å®ç°ä½ç½®**ï¼š
- `src/lib/youtube.ts` - ç¬¬ 268, 348, 401 è¡Œ

---

### âœ… 6. æ‰¹é‡å¤„ç†ï¼ˆmaxResults=50ï¼‰

**ä¼˜åŒ–**ï¼š
```typescript
// getVideos - æ‰¹é‡ 50 ä¸ª
const chunks = []
for (let i = 0; i < videoIds.length; i += 50) {
  chunks.push(videoIds.slice(i, i + 50))
}
// é…é¢: Math.ceil(videoIds.length / 50) Ã— 1 unit

// getChannels - æ‰¹é‡ 50 ä¸ª
const chunks = []
for (let i = 0; i < channelIds.length; i += 50) {
  chunks.push(channelIds.slice(i, i + 50))
}
// é…é¢: Math.ceil(channelIds.length / 50) Ã— 1 unit
```

**æ•ˆæœ**ï¼š
- âœ… 100 ä¸ªè§†é¢‘: 2 æ¬¡è°ƒç”¨ (è€Œé 100 æ¬¡)
- âœ… 100 ä¸ªé¢‘é“: 2 æ¬¡è°ƒç”¨ (è€Œé 100 æ¬¡)

**å®ç°ä½ç½®**ï¼š
- `src/lib/youtube.ts` - ç¬¬ 326-370, 386-418 è¡Œ

---

## ğŸš€ è¿›ä¸€æ­¥ä¼˜åŒ–æ–¹æ¡ˆ

### ğŸ”§ æ–¹æ¡ˆ 1: å‡å°‘è§†é¢‘æ•°é‡ç›®æ ‡

**å½“å‰**ï¼š
```typescript
const targetVideoCount = debugMode ? 30 : 100
```

**ä¼˜åŒ–**ï¼š
```typescript
const targetVideoCount = debugMode ? 20 : 80  // é™ä½ 20%
```

**æ•ˆæœ**ï¼š
- search.list å¯èƒ½æå‰ç»ˆæ­¢ï¼ˆå°‘ 1 æ¬¡è°ƒç”¨ï¼‰
- videos.list æ‰¹é‡æ•°å‡å°‘ï¼ˆå°‘ 1 æ¬¡è°ƒç”¨ï¼‰

---

### ğŸ”§ æ–¹æ¡ˆ 2: å¢åŠ  search.list ç»“æœç¼“å­˜

**å½“å‰**ï¼šç¼“å­˜å•ä¸ªæŸ¥è¯¢ç»“æœ

**ä¼˜åŒ–**ï¼šç¼“å­˜æ•´ä¸ªåˆ†æç»“æœ

```typescript
// ç¼“å­˜é”®: competitor + platform
const cacheKey = `analysis:${competitorId}:${platform}`
const cached = cache.get(cacheKey)
if (cached) {
  return cached  // ç›´æ¥è¿”å›æ•´ä¸ªç»“æœ - 0 é…é¢
}
```

---

### ğŸ”§ æ–¹æ¡ˆ 3: åˆ†é¡µæ§åˆ¶

**å½“å‰**ï¼š
```typescript
maxResults: 25  // æ¯æ¬¡æŸ¥è¯¢ 25 ä¸ªç»“æœ
```

**ä¼˜åŒ–**ï¼š
```typescript
maxResults: debugMode ? 10 : 20  // å‡å°‘å•æ¬¡ç»“æœæ•°
```

**æ•ˆæœ**ï¼š
- ä¸å½±å“æ€»é…é¢ï¼ˆ100 units per callï¼‰
- ä½†å¯ä»¥æ›´å¿«è¾¾åˆ° targetVideoCountï¼Œæå‰ç»ˆæ­¢å¾ªç¯

---

### ğŸ”§ æ–¹æ¡ˆ 4: å¤±è´¥é™çº§ç­–ç•¥

**ä¼˜åŒ–**ï¼š
```typescript
// é‡åˆ° quotaExceededï¼Œä½¿ç”¨é™çº§ç­–ç•¥
if (quotaStatus.exceeded) {
  // 1. åªä½¿ç”¨ç¼“å­˜æ•°æ®
  const cachedResults = await getCachedAnalysis(competitorId)
  if (cachedResults) {
    return { ...cachedResults, fromCache: true, warning: 'Using cached data due to quota limits' }
  }
  
  // 2. è¿”å›éƒ¨åˆ†ç»“æœ
  if (channelEvidenceMap.size > 0) {
    return { channels: partialResults, warning: 'Partial results due to quota limits' }
  }
  
  // 3. æç¤ºç”¨æˆ·ç¨åé‡è¯•
  return { error: 'Quota exceeded. Please try again later.' }
}
```

---

## ğŸ“ è¿›ä¸€æ­¥ä¼˜åŒ–ä»£ç ä¿®æ”¹

è®©æˆ‘å®ç°ä¸Šè¿°ä¼˜åŒ–æ–¹æ¡ˆ 1, 2, 3ã€‚
